<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Ducky Profile</title>
    <meta name="description" content="View your Ducky profile and linked servers.">
    <link rel="icon" href="https://duckybot.xyz/images/Ducky.svg">
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600;700&display=swap" rel="stylesheet">
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css" rel="stylesheet">
    <style>
        body { font-family: 'Inter', sans-serif; background: #0f0f0f; }
        .glass-card {
            background: rgba(245, 255, 130, 0.03);
            border: 1px solid rgba(245, 255, 130, 0.1);
            backdrop-filter: blur(20px);
            border-radius: 16px;
            transition: all 0.3s ease;
        }
        .glass-card:hover { border-color: rgba(245, 255, 130, 0.8); }
        .glow {
            position: absolute;
            width: 100%;
            height: 300px;
            border-radius: 50%;
            filter: blur(120px);
            opacity: 0.08;
            z-index: -1;
        }
        .toast {
            position: fixed;
            bottom: 20px;
            right: 20px;
            transform: translateY(100px);
            transition: transform 0.3s ease;
            z-index: 1000;
        }
        .toast.show { transform: translateY(0); }
    </style>
</head>
<body class="text-white">
    <div class="glow bg-[#F5FF82] top-0 left-0"></div>
    <div class="glow bg-[#F5FF82] bottom-0 right-0"></div>

    <nav class="sticky top-0 z-50 backdrop-blur-sm border-b border-white/5">
        <div class="max-w-7xl mx-auto px-4 py-4">
            <a href="/" class="flex items-center gap-3">
                <img src="https://duckybot.xyz/images/Ducky.svg" alt="Ducky" class="w-8 h-8">
                <span class="text-2xl font-bold text-[#F5FF82]">Ducky</span>
            </a>
        </div>
    </nav>

    <main class="min-h-screen flex items-center justify-center py-12 px-4">
        <div class="glass-card p-8 max-w-xl w-full">
            <div id="profile-content" class="space-y-8">
                <div class="flex items-center gap-6 justify-center">
                    <div class="text-center">
                        <img id="discord-avatar" class="w-24 h-24 rounded-full mb-2 hidden" src="" alt="Discord">
                        <span class="text-sm text-gray-400">Discord</span>
                    </div>
                    <div class="text-center">
                        <img id="roblox-avatar" class="w-24 h-24 rounded-full mb-2 hidden" src="" alt="Roblox">
                        <span class="text-sm text-gray-400">Roblox</span>
                    </div>
                </div>
                <div class="text-center">
                    <h2 id="username" class="text-2xl font-bold mb-2"></h2>
                    <p id="roblox-info" class="text-gray-400"></p>
                </div>
                <div id="servers-section" class="hidden space-y-4">
                    <h3 class="text-xl font-semibold">Linked Servers</h3>
                    <div id="server-list" class="space-y-2"></div>
                </div>
                <button id="unlink-button" onclick="showConfirmDialog()" class="hidden w-full py-3 px-4 bg-red-500/10 text-red-400 rounded-lg hover:bg-red-500/20 transition">
                    <i class="fas fa-unlink mr-2"></i>Unlink Account
                </button>
            </div>
        </div>
    </main>

    <div id="confirm-dialog" class="fixed inset-0 bg-black/50 backdrop-blur-sm hidden items-center justify-center">
        <div class="glass-card p-6 max-w-sm mx-4">
            <h2 class="text-xl font-bold mb-4">Unlink Account</h2>
            <p class="text-gray-300 mb-6">Are you sure you want to unlink your Roblox account?</p>
            <div class="flex gap-4 justify-end">
                <button onclick="closeConfirmDialog()" class="px-4 py-2 bg-[#F5FF82]/10 text-[#F5FF82] rounded-lg">Cancel</button>
                <button onclick="confirmUnlink()" class="px-4 py-2 bg-red-500/10 text-red-400 rounded-lg">Unlink</button>
            </div>
        </div>
    </div>

    <div id="toast" class="toast glass-card p-4 hidden"></div>

    <script>
        const showToast = (msg, type) => {
            const toast = document.getElementById('toast');
            toast.textContent = msg;
            toast.className = `toast glass-card p-4 ${type} show`;
            setTimeout(() => toast.className = 'toast glass-card p-4 hidden', 3000);
        };

        const init = async () => {
            const token = document.cookie.match(/discord=([^;]+)/)?.[1];
            if (!token) return window.location.href = "/login?redirect=link-profile";

            try {
                const discord = await fetch('https://discord.com/api/users/@me', {
                    headers: { authorization: `Bearer ${token}` }
                });
                if (!discord.ok) throw new Error();
                
                const user = await discord.json();
                const profile = await fetch(`https://api.duckybot.xyz/link/${user.id}`).then(r => r.json());
                
                if (profile.code === 200) {
                    const {discordUser, robloxUser, servers} = profile.data;
                    document.getElementById('discord-avatar').src = discordUser.avatar;
                    document.getElementById('roblox-avatar').src = robloxUser.avatar;
                    document.getElementById('username').textContent = `${discordUser.name} â€¢ ${robloxUser.displayName}`;
                    document.getElementById('roblox-info').innerHTML = `<a href="${robloxUser.profile}" class="text-[#F5FF82]">@${robloxUser.name}</a>`;
                    
                    if (servers?.length) {
                        document.getElementById('servers-section').classList.remove('hidden');
                        document.getElementById('server-list').innerHTML = servers.map(s => 
                            `<div class="glass-card p-4"><div class="font-semibold">${s.name}</div><div class="text-sm text-gray-400">Role: ${s.role}</div></div>`
                        ).join('');
                    }
                    
                    ['discord-avatar', 'roblox-avatar', 'unlink-button'].forEach(id => 
                        document.getElementById(id).classList.remove('hidden')
                    );
                }
            } catch {
                showToast('Failed to load profile', 'error');
            }
        };

        window.onload = init;
    </script>
</body>
</html>