<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Link Roblox</title>
</head>
<body>
    Give us a moment...
</body>
<script>
    window.onload = () => {
        function getCookie(name) {
            let value = `; ${document.cookie}`;
            let parts = value.split(`; ${name}=`);
            if (parts.length === 2) return parts.pop().split(';').shift();
        }
        const loggedin = getCookie('discord')
        if (loggedin) {
            fetch('https://discord.com/api/users/@me', {
                headers: {
                    authorization: `Bearer ${loggedin}`,
                },
            })
            .then(result => result.json())
            .then(response => {
                const id = response.id
                fetch('https://glowworm-learning-leech.ngrok-free.app/get', {
                    method: "GET",
                    headers: {
                        "authorization": "9W7A890Z3gMD07JYzmR8Y5AIxGtU3N76CUr1c76F1rdO96d0Y9MlMnQLr95D109pi584N7yr6X6K2Q05aU30J99w2P2e06u86Z75",
                        "ngrok-skip-browser-warning": "69420"
                    },
                })
                .then(result => result.json())
                .then(response => {
                    const links = response.links
                    links.forEach(link => {
                        if (link && link.discord && link.discord == id) {
                            document.body.innerHTML = "You're linked with " + link.roblox + "."
                            return
                        } else {
                            console.log("Link does not meet conditions:")
                            console.log(link)
                        }
                    })
                    document.body.innerHTML = "You aren't linked."
                })
                .catch(console.error)
            })
            .catch(console.error)

            return
        } else {
            document.body.innerHTML = "You're not logged in.<br><br>Redirecting you to the login page...<br>You'll automatically be redirected back here."
            window.location.href = "https://duckybot.xyz/login?redirect=link"
            return
        }
    }
</script>
</html>